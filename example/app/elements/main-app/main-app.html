<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">

<link rel="import" href="../../elements/message-router/message-router.html">

<polymer-element name="main-app" attributes="">
  <template>

    <message-router io="{{socket}}"></message-router>
    <link rel="stylesheet" href="main-app.css">
    <div>
        <button on-click="{{newGame}}">New Game</button>
    </div>
    Games:
    <ul id="gamelist">
        <template repeat="{{game in games}}">
            <li>
                <input is="core-input" gameid="{{game.id}}" value="{{game.name}}" on-change="{{onGameNameChange}}"> </input> <paper-button on-click="selectGame({{game}})">Select</paper-button>
            </li>
        </template>
    </ul>

  </template>
  <script>
    (function () {

      Polymer({
        ready: function ()
        {
            console.log('main app starting up');
            this.socket = io();
            this.asyncFire('core-signal', {name: "emit", data: {target:'listGames', cb: this.onListGames.bind(this) }});
        },

        newGame: function()
        {
            console.log('new game clicked');
            this.asyncFire('core-signal', {name: "emit", data: {target:'newGame', cb: this.onNewGame.bind(this) }});
            this.asyncFire('core-signal', {name: "emit", data: {target:'listGames', cb: this.onListGames.bind(this) }});
        },

        onNewGame: function(reply)
        {
            console.log('onNewGame called. reply is');
            console.dir(reply);
        },

        onListGames: function(games)
        {
            console.log("onGamesList called with ");
            console.dir(games);
            this.games = games;
        },

          onGameNameChange: function(e, err, el)
          {
              console.log("onGameNameChange called");
              console.dir(arguments);
              var name = el.value;
              console.log("new name is "+name);
          },

          selectGame: function(game)
          {
              console.log("selectGame called");
              console.dir(arguments);
          }

      });
    })();
  </script>
</polymer-element>
