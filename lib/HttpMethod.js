// Generated by CoffeeScript 1.9.1
(function() {
  var HttpMethod, url, uuid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  uuid = require('node-uuid');

  url = require('url');

  HttpMethod = (function() {
    HttpMethod.httproutes = [];

    function HttpMethod(messageRouter, app, basePath) {
      this.expose = bind(this.expose, this);
      app.use(basePath + ':target', function(req, res) {
        var ip, message, p, part, port, target, url_parts;
        ip = req.connection.remoteAddress;
        port = req.connection.remotePort;
        target = HtpMethod.httproutes[req.params.target];
        if (target) {
          url_parts = url.parse(req.url, true);
          message = {
            client: ip + ':' + port,
            target: req.params.target,
            messageId: url_parts.messageId || uuid.v4()
          };
          for (p in url_parts) {
            part = url_parts[p];
            message[p] = part;
          }
          message.replyFunc = function(reply) {
            res.json(reply);
            return console.log('express calling target');
          };
          return target(message);
        }
      });
      messageRouter.addMethod('express', this);
    }

    HttpMethod.prototype.registrationFunc = function(targetName, targetFunc) {
      return HttpMethod.httproutes[targetName] = targetFunc;
    };

    HttpMethod.prototype.expose = function(type) {
      return console.log('HttpMethod::Expose called for type ' + type + ' (unimplemented)');
    };

    return HttpMethod;

  })();

  module.exports = HttpMethod;

}).call(this);

//# sourceMappingURL=HttpMethod.js.map
