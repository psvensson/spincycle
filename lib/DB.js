// Generated by CoffeeScript 1.8.0
(function() {
  var DB, DataStore, LRU, all, promise, uuid;

  promise = require('node-promise').Promise;

  all = require('node-promise').all;

  uuid = require('node-uuid');

  LRU = require('lru-cache');

  DataStore = require('./../gds');

  DB = (function() {
    function DB() {}

    DB.lru = LRU();

    DB.lrudiff = LRU();

    DB.get = function(type, ids) {
      var q;
      q = new promise();
      all(ids.map(function(id) {
        var p, rv;
        rv = DB.lru.get(id);
        p = new promise();
        if (!rv) {
          DataStore.get(type, id, function(result) {
            this.lru.set(id, result);
            return p.resolve(result);
          });
        } else {
          p.resolve(rv);
        }
        return p;
      })).then(function(result) {
        return q.resolve(result);
      });
      return q;
    };

    DB.set = function(type, obj) {
      return DB.lru.set(obj.id, obj);
    };

    return DB;

  })();

  module.exports = DB;

}).call(this);

//# sourceMappingURL=DB.js.map
